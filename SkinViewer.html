<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SirDexal's Champion Finder (Debug)</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #2a2a2a 100%);
    min-height: 100vh;
    color: #e0e0e0;
  }

  .loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    backdrop-filter: blur(10px);
    transition: opacity 0.3s ease;
  }

  .loading-spinner {
    width: 60px;
    height: 60px;
    border: 4px solid rgba(138, 43, 226, 0.3);
    border-top: 4px solid #bb86fc;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
  }

  .loading-text {
    color: #bb86fc;
    font-size: 1.4rem;
    font-weight: 600;
    text-align: center;
    text-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
  }

  .loading-subtext {
    color: #999999;
    font-size: 1rem;
    margin-top: 10px;
    text-align: center;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: 30px;
    align-items: start;
  }

  .left-panel {
    position: sticky;
    top: 20px;
    background: rgba(0, 0, 0, 0.95);
    border-radius: 20px;
    padding: 20px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(138, 43, 226, 0.4);
    box-shadow: 0 10px 30px rgba(138, 43, 226, 0.2);
  }

  .main-content {
    min-height: 100vh;
  }

  h1 { 
    text-align: center;
    color: #bb86fc;
    font-size: 2.5rem;
    margin-bottom: 30px;
    text-shadow: 2px 2px 8px rgba(138, 43, 226, 0.5);
    grid-column: 1 / -1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
  }

  .title-photo {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #bb86fc;
    box-shadow: 0 0 16px 2px rgba(138,43,226,0.4), 0 2px 8px rgba(0,0,0,0.5);
    background: linear-gradient(135deg, #1a1a1a 60%, #bb86fc 100%);
    margin-right: 10px;
  }

  .champions-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    padding: 15px;
    background: rgba(138, 43, 226, 0.1);
    border-radius: 15px;
    margin-bottom: 15px;
    transition: all 0.3s ease;
    border: 1px solid rgba(138, 43, 226, 0.3);
  }

  .champions-header:hover {
    background: rgba(138, 43, 226, 0.2);
    border-color: rgba(138, 43, 226, 0.5);
  }

  .champions-title {
    color: #bb86fc;
    font-size: 1.2rem;
    font-weight: 700;
  }

  .toggle-icon {
    color: #bb86fc;
    font-size: 1.5rem;
    transition: transform 0.3s ease;
    width: 20px;
    height: 20px;
    fill: #bb86fc;
  }

  .champions-header.collapsed .toggle-icon {
    transform: rotate(-90deg);
  }

  .search-container {
    margin-bottom: 15px;
    overflow: hidden;
    transition: all 0.3s ease;
    position: relative;
  }

  .search-container.collapsed {
    max-height: 0;
    margin-bottom: 0;
    opacity: 0;
  }

  .search-icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    width: 16px;
    height: 16px;
    fill: #999999;
    pointer-events: none;
  }

  .search-box {
    width: 100%;
    padding: 12px 16px 12px 40px;
    font-size: 0.9rem;
    border: none;
    border-radius: 15px;
    background: rgba(0, 0, 0, 0.8);
    color: #e0e0e0;
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    outline: none;
    transition: all 0.3s ease;
    border: 1px solid rgba(138, 43, 226, 0.3);
  }

  .search-box:focus {
    background: rgba(0, 0, 0, 1);
    box-shadow: 0 4px 20px rgba(138, 43, 226, 0.6);
    border-color: #bb86fc;
  }

  .search-box:focus + .search-icon {
    fill: #bb86fc;
  }

  .search-box::placeholder {
    color: #999999;
  }

  #championList {
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-height: 55vh;
    overflow-y: auto;
    padding-right: 8px;
    transition: all 0.3s ease;
  }

  #championList.collapsed {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
  }

  #championList::-webkit-scrollbar { width: 6px; }
  #championList::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.3); border-radius: 10px; }
  #championList::-webkit-scrollbar-thumb { background: rgba(138, 43, 226, 0.7); border-radius: 10px; }
  #championList::-webkit-scrollbar-thumb:hover { background: rgba(138, 43, 226, 0.9); }

  .champion-item {
    cursor: pointer; border: 2px solid transparent; padding: 12px; display: flex;
    align-items: center; gap: 12px; background: rgba(0, 0, 0, 0.6);
    border-radius: 15px; position: relative; transition: all 0.3s ease;
    user-select: none; overflow: hidden; backdrop-filter: blur(5px); min-height: 65px;
  }
  .champion-item:hover {
    transform: translateX(5px); background: rgba(20, 20, 20, 0.8);
    border-color: rgba(138, 43, 226, 0.6); box-shadow: 0 4px 15px rgba(138, 43, 226, 0.3);
  }
  .champion-item img {
    width: 45px; height: 45px; object-fit: cover; border-radius: 10px;
    border: 2px solid rgba(138, 43, 226, 0.4); transition: all 0.3s ease; flex-shrink: 0;
  }
  .champion-item:hover img { border-color: #bb86fc; transform: scale(1.05); }
  .champion-name {
    font-size: 0.95rem; font-weight: 700; color: #ffffff;
    text-shadow: 0 1px 3px rgba(0,0,0,0.8); flex: 1; text-align: left; line-height: 1.2;
  }
  .champion-item.selected {
    border-color: #bb86fc;
    background: linear-gradient(135deg, rgba(138, 43, 226, 0.4), rgba(187, 134, 252, 0.3));
    color: white; box-shadow: 0 4px 20px rgba(138, 43, 226, 0.5); transform: translateX(8px);
  }
  .champion-item.selected .champion-name {
    color: white; font-weight: 800; text-shadow: 0 0 8px rgba(138, 43, 226, 0.8);
  }
  .champion-item.selected img {
    border-color: #bb86fc; box-shadow: 0 0 15px rgba(138, 43, 226, 0.7);
  }
  .champion-item.selected::after {
    content: 'âœ“'; position: absolute; top: 50%; right: 12px; transform: translateY(-50%);
    background: rgba(187, 134, 252, 0.9); color: #000000; font-size: 0.9rem; font-weight: bold;
    width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center;
    justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.5);
  }
  .champion-item.hidden { display: none; }

  .skins-header {
    color: #bb86fc; font-size: 1.8rem; font-weight: 800; margin-bottom: 25px;
    text-shadow: 2px 2px 8px rgba(138, 43, 226, 0.6); margin-top: 0; padding-top: 0; text-align: center;
  }
  .skins {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px; justify-items: center;
  }
  .skin-card {
    border: none; background: rgba(0, 0, 0, 0.85); padding: 20px; width: 100%;
    max-width: 300px; text-align: center; border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.6); backdrop-filter: blur(10px);
    transition: all 0.3s ease; overflow: hidden; border: 1px solid rgba(138, 43, 226, 0.3);
    position: relative; 
  }
  .skin-card.has-chromas { cursor: pointer; }
  .skin-card.has-chromas::before {
    content: 'ðŸŽ¨'; position: absolute; top: 10px; right: 10px;
    background-color: rgba(187, 134, 252, 0.8); color: #000; padding: 2px 6px;
    border-radius: 5px; font-size: 0.8rem; font-weight: bold; box-shadow: 0 1px 3px rgba(0,0,0,0.5);
  }
  .skin-card:hover {
    transform: translateY(-8px); box-shadow: 0 15px 40px rgba(138, 43, 226, 0.4);
    border-color: rgba(138, 43, 226, 0.7);
  }
  .skin-card img {
    width: 100%; height: 200px; object-fit: cover; object-position: center top;
    border-radius: 15px; margin-bottom: 15px; transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
  }
  .skin-card:hover img { transform: scale(1.05); }
  .skin-card h3 {
    font-size: 1.2rem; margin-bottom: 8px; color: #ffffff; font-weight: 700;
    min-height: 2.4em; line-height: 1.2em;
  }
  .skin-card p { color: #bb86fc; font-size: 0.9rem; font-weight: 500; }
  .loading { text-align: center; color: #bb86fc; font-size: 1.1rem; padding: 30px; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .skin-card { animation: fadeIn 0.5s ease forwards; }

  .chroma-modal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.85); backdrop-filter: blur(10px);
    display: none; align-items: center; justify-content: center;
    z-index: 2000; padding: 20px; opacity: 0; transition: opacity 0.3s ease;
  }
  .chroma-modal.visible { display: flex; opacity: 1; }
  .chroma-modal-content {
    background: rgba(20, 20, 20, 0.95); border: 1px solid rgba(138, 43, 226, 0.5);
    padding: 25px; border-radius: 20px; box-shadow: 0 10px 40px rgba(138, 43, 226, 0.3);
    display: flex; gap: 25px; max-width: 90vw; max-height: 90vh; width: 1200px;
  }
  .chroma-modal-close {
    position: absolute; top: 15px; right: 20px; font-size: 2rem; color: #bb86fc;
    cursor: pointer; background: none; border: none; line-height: 1;
  }
   .chroma-modal-close:hover { color: white; }
  .chroma-modal-left {
    flex: 2; display: flex; flex-direction: column; align-items: center;
  }
  .chroma-modal-left img {
    width: 100%; max-height: calc(85vh - 100px); object-fit: contain;
    border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.5);
    border: 2px solid rgba(138, 43, 226, 0.3);
  }
  .chroma-modal-title {
    color: #bb86fc; font-size: 1.6rem; margin-bottom: 15px;
    text-align: center; font-weight: 700;
  }
  .chroma-modal-right {
    flex: 1; display: flex; flex-direction: column; overflow-y: auto;
    padding-right: 10px; max-height: calc(85vh - 50px);
  }
  .chroma-modal-right::-webkit-scrollbar { width: 6px; }
  .chroma-modal-right::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.3); border-radius: 10px; }
  .chroma-modal-right::-webkit-scrollbar-thumb { background: rgba(138, 43, 226, 0.7); border-radius: 10px; }
  .chroma-item {
    display: flex; align-items: center; gap: 12px; padding: 10px;
    border-radius: 10px; cursor: pointer; transition: background-color 0.2s ease;
    border: 2px solid transparent; background-color: rgba(0,0,0,0.3); margin-bottom: 8px;
  }
  .chroma-item:hover, .chroma-item.active {
    background-color: rgba(138, 43, 226, 0.2); border-color: rgba(138, 43, 226, 0.6);
  }
  .chroma-item img {
    width: 60px; height: 60px; object-fit: cover; border-radius: 8px;
    border: 1px solid rgba(138, 43, 226, 0.4);
  }
  .chroma-item-name { font-size: 0.9rem; color: #e0e0e0; font-weight: 600; }

  @media (max-width: 1024px) {
    .container { grid-template-columns: 1fr; gap: 20px; }
    .left-panel { position: static; }
    #championList { max-height: 40vh; }
    .chroma-modal-content {
      flex-direction: column; width: 90vw; max-height: 85vh; overflow-y: auto;
    }
    .chroma-modal-left img { max-height: 40vh; }
    .chroma-modal-right { max-height: 35vh; }
  }
  @media (max-width: 768px) {
    h1 { font-size: 2rem; }
    .container { padding: 15px; }
    .champion-item { padding: 10px; min-height: 60px; }
    .champion-item img { width: 40px; height: 40px; }
    .champion-name { font-size: 0.9rem; }
    .skins { grid-template-columns: 1fr; }
    .chroma-modal-title { font-size: 1.3rem; }
    .chroma-item img { width: 50px; height: 50px; }
    .chroma-item-name { font-size: 0.85rem; }
  }
  
  /* DEBUG BUTTON STYLE */
  #debugOpenModalButton {
    position: fixed;
    bottom: 10px;
    right: 10px;
    padding: 10px 15px;
    background-color: #bb86fc;
    color: black;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    z-index: 3000;
    font-weight: bold;
  }
</style>
</head>
<body>

<div id="loadingOverlay" class="loading-overlay">
  <div class="loading-spinner"></div>
  <div class="loading-text">We are getting latest info...</div>
  <div class="loading-subtext">Fetching current patch data</div>
</div>

<div class="container">
  <h1>
  <img class="title-photo" src="https://lh3.googleusercontent.com/a/ACg8ocJivPuZZ5y9fxoA_XUKPzlm7MExzijiDYgWvZVGkHtIrHOZdO7I=s192-c-mo" alt="SirDexal" />
    SirDexal's Champion Finder
  </h1>
  
  <div class="left-panel">
    <div class="champions-header" id="championsHeader">
      <div class="champions-title">Champions</div>
      <svg class="toggle-icon" viewBox="0 0 24 24"> <path d="M7 10L12 15L17 10H7Z"/> </svg>
    </div>
    <div class="search-container" id="searchContainer">
      <input type="text" class="search-box" placeholder="Search champions..." id="searchBox">
      <svg class="search-icon" viewBox="0 0 24 24"> <path d="M15.5 14H14.71L14.43 13.73C15.41 12.59 16 11.11 16 9.5C16 5.91 13.09 3 9.5 3S3 5.91 3 9.5S5.91 16 9.5 16C11.11 16 12.59 15.41 13.73 14.43L14 14.71V15.5L19 20.49L20.49 19L15.5 14ZM9.5 14C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5S14 7.01 14 9.5S11.99 14 9.5 14Z"/> </svg>
    </div>
    <div id="championList"> <div class="loading">Loading champions...</div> </div>
  </div>

  <div class="main-content">
    <div id="skinsContainer">
      <div class="skins-header" id="skinsHeaderEl" style="display: none;"></div>
      <div class="skins" id="skinsList"></div>
    </div>
  </div>
</div>

<div id="chromaModal" class="chroma-modal">
  <div class="chroma-modal-content">
    <button id="chromaModalClose" class="chroma-modal-close">Ã—</button>
    <div class="chroma-modal-left">
      <h2 id="chromaModalTitle" class="chroma-modal-title">Skin Name - Chromas</h2>
      <img id="chromaModalSplash" src="" alt="Selected Chroma Splash">
    </div>
    <div id="chromaListEl" class="chroma-modal-right"> </div>
  </div>
</div>

<button id="debugOpenModalButton">DEBUG: Test Open Modal</button>

<script>
let patchVersion = null;
const championListEl = document.getElementById('championList');
const skinsList = document.getElementById('skinsList');
const skinsHeaderEl = document.getElementById('skinsHeaderEl'); 
const searchBox = document.getElementById('searchBox');
const loadingOverlay = document.getElementById('loadingOverlay');
const championsHeaderToggle = document.getElementById('championsHeader'); 
const searchContainer = document.getElementById('searchContainer');

const chromaModal = document.getElementById('chromaModal');
const chromaModalClose = document.getElementById('chromaModalClose');
const chromaModalTitle = document.getElementById('chromaModalTitle');
const chromaModalSplash = document.getElementById('chromaModalSplash');
const chromaListEl = document.getElementById('chromaListEl'); 

let selectedChampionData = null; 
let allChampions = [];
let allSkinsData = null; 
let isListCollapsed = false;

const CDRAGON_BASE_URL = 'https://raw.communitydragon.org/latest/plugins/rcp-be-lol-game-data/global/default';
const DDRAGON_BASE_URL = 'https://ddragon.leagueoflegends.com/cdn';

championsHeaderToggle.addEventListener('click', () => {
  isListCollapsed = !isListCollapsed;
  championsHeaderToggle.classList.toggle('collapsed', isListCollapsed);
  searchContainer.classList.toggle('collapsed', isListCollapsed);
  championListEl.classList.toggle('collapsed', isListCollapsed);
});

async function getLatestPatch() {
  try {
    const response = await fetch('https://ddragon.leagueoflegends.com/api/versions.json');
    const versions = await response.json();
    console.log("Latest patch version fetched:", versions[0]);
    return versions[0];
  } catch (error) {
    console.error('Could not fetch latest patch:', error);
    return '14.1.1'; 
  }
}

async function fetchAllSkinsData() {
  console.log("%cAttempting to fetch CDragon skins.json...", "color: yellow; font-weight: bold;");
  document.querySelector('.loading-subtext').textContent = 'Fetching all skin chroma data (CDragon)...';
  try {
    const response = await fetch(`${CDRAGON_BASE_URL}/v1/skins.json`);
    if (!response.ok) {
      console.error(`%cCDragon skins.json fetch FAILED! Status: ${response.status}`, "color: red; font-weight: bold;");
      const errorText = await response.text();
      console.error("CDragon error response text:", errorText);
      document.querySelector('.loading-subtext').textContent = 'Error: Could not load chroma data. Chromas may not be available.';
      alert(`HATA: Chroma verisi (skins.json) yÃ¼klenemedi. Sunucu durumu: ${response.status}. YanÄ±t: ${errorText}. Chroma Ã¶zelliÄŸi Ã§alÄ±ÅŸmayabilir.`);
      return new Map();
    }

    const rawSkinsObject = await response.json(); // ArtÄ±k bu bir nesne, dizi deÄŸil

    console.log("%c--- DEBUG: skins.json Raw Data Structure ---", "background: #222; color: #bada55; font-size: 1.1em;");
    console.log("Type of rawSkinsObject:", typeof rawSkinsObject);
    console.log("Is it an array?", Array.isArray(rawSkinsObject));
    // console.log("Raw data (full object):"); // Bu Ã§ok bÃ¼yÃ¼k olabilir, ÅŸimdilik kapatalÄ±m
    // console.log(rawSkinsObject); 
    console.log("%c--- END DEBUG ---", "background: #222; color: #bada55; font-size: 1.1em;");

    let cdragonSkinsArrayToProcess;

    if (typeof rawSkinsObject === 'object' && rawSkinsObject !== null && !Array.isArray(rawSkinsObject)) {
        // rawSkinsObject bir nesne ve anahtarlarÄ± kostÃ¼m ID'leri, deÄŸerleri kostÃ¼m detaylarÄ±
        // Bu deÄŸerleri bir diziye Ã§evirelim
        cdragonSkinsArrayToProcess = Object.values(rawSkinsObject);
        console.log(`%cConverted skins object to an array of ${cdragonSkinsArrayToProcess.length} skin objects using Object.values().`, "color: lightblue; font-weight: bold;");
    } else if (Array.isArray(rawSkinsObject)) {
        // EÄŸer bir ÅŸekilde API tekrar dizi dÃ¶ndÃ¼rÃ¼rse diye bu kontrolÃ¼ bÄ±rakalÄ±m
        console.warn("Raw data from skins.json is an array. Using it directly (unexpected but handled).");
        cdragonSkinsArrayToProcess = rawSkinsObject;
    } else {
        console.error("%cCRITICAL: rawSkinsObject from skins.json is not a processable object or array.", "color: red; font-weight: bold;");
        alert("KRÄ°TÄ°K HATA: skins.json verisi beklenmedik bir formatta. Chroma Ã¶zelliÄŸi Ã§alÄ±ÅŸmayabilir.");
        return new Map();
    }
    
    if (!Array.isArray(cdragonSkinsArrayToProcess)) {
        console.error("%cFATAL: cdragonSkinsArrayToProcess is still not an array after attempting to process raw data. Cannot proceed.", "color: red; font-size: 1.3em;");
        alert("FATAL HATA: Chroma verisi dÃ¼zgÃ¼n bir diziye dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lemedi. SayfayÄ± yenileyin veya daha sonra tekrar deneyin.");
        return new Map();
    }

    console.log(`%cProcessing ${cdragonSkinsArrayToProcess.length} skin entries from CDragon.`, "color: green;");
    
    const skinsMap = new Map();
    cdragonSkinsArrayToProcess.forEach(skin => {
      // skin objesi artÄ±k { id: 1000, name: "Goth Annie", chromas: [...] } gibi bir yapÄ±ya sahip olmalÄ±
      if (skin && typeof skin.id === 'number' && skin.chromas && skin.chromas.length > 0) {
        skinsMap.set(skin.id, skin.chromas);
      } else {
        // HatalÄ± veya eksik skin objelerini loglayabiliriz
        // console.warn("Skipping skin entry due to missing id or chromas:", skin);
      }
    });
    console.log(`%cProcessed CDragon data. Found ${skinsMap.size} skins with defined chromas.`, "color: lightgreen; font-weight: bold;");
    if (skinsMap.size === 0 && cdragonSkinsArrayToProcess.length > 0) {
        console.warn("%cWARNING: CDragon skins.json was processed, but no skins with chromas were identified in it. Chroma functionality will be limited.", "color: orange;");
    }
    return skinsMap;

  } catch (error) {
    console.error('%cCritial error during fetchAllSkinsData:', "color: red; font-weight: bold;", error);
    console.error("Error name:", error.name);
    console.error("Error stack:", error.stack);
    alert(`KRÄ°TÄ°K HATA: Chroma verisi iÅŸlenirken sorun oluÅŸtu: ${error.message}. Chroma Ã¶zelliÄŸi Ã§alÄ±ÅŸmayabilir.`);
    return new Map(); 
  }
}

async function initializeApp() {
  try {
    document.querySelector('.loading-subtext').textContent = 'Getting latest patch version...';
    patchVersion = await getLatestPatch();
    
    allSkinsData = await fetchAllSkinsData(); 
    if (allSkinsData.size === 0) {
        console.warn('%cWARNING: allSkinsData map is empty after fetch. Chroma features will likely not work.', "color: orange; font-size: 1.2em;");
        // alert("UYARI: Chroma veri haritasÄ± (allSkinsData) boÅŸ. Chroma Ã¶zellikleri bÃ¼yÃ¼k ihtimalle Ã§alÄ±ÅŸmayacaktÄ±r.");
    } else {
        console.log(`%cSUCCESS: allSkinsData map populated with ${allSkinsData.size} entries.`, "color: green; font-size: 1.2em;");
    }

    document.querySelector('.loading-subtext').textContent = `Loading champions for patch ${patchVersion}...`;
    await loadChampions();
    
    setTimeout(() => {
      loadingOverlay.style.opacity = '0';
      setTimeout(() => loadingOverlay.style.display = 'none', 300);
    }, 500);
    
  } catch (error) {
    console.error('Initialization error:', error);
    document.querySelector('.loading-text').textContent = 'Failed to load data';
    document.querySelector('.loading-subtext').textContent = 'Please refresh the page';
  }
}

async function loadChampions() {
  try {
    const response = await fetch(`${DDRAGON_BASE_URL}/${patchVersion}/data/en_US/champion.json`);
    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
    
    const data = await response.json();
    championListEl.innerHTML = '';
    const champions = data.data;
    
    if (!champions || Object.keys(champions).length === 0) throw new Error('No champions data found');
    
    allChampions = Object.values(champions).sort((a, b) => a.name.localeCompare(b.name));
    
    allChampions.forEach(champ => {
      const div = document.createElement('div');
      div.className = 'champion-item';
      div.title = champ.title;
      div.dataset.championId = champ.id; // String ID like 'Aatrox'
      div.dataset.championName = champ.name.toLowerCase();

      const img = document.createElement('img');
      img.src = `${DDRAGON_BASE_URL}/${patchVersion}/img/champion/${champ.image.full}`;
      img.alt = champ.name;
      img.onerror = function() { this.src = `${DDRAGON_BASE_URL}/14.1.1/img/champion/${champ.image.full}`; };

      const nameDiv = document.createElement('div');
      nameDiv.className = 'champion-name';
      nameDiv.textContent = champ.name;

      div.appendChild(img);
      div.appendChild(nameDiv);

      div.addEventListener('click', () => {
        document.querySelectorAll('.champion-item.selected').forEach(el => el.classList.remove('selected'));
        div.classList.add('selected');
        selectedChampionData = champ; 
        console.log(`%cChampion selected: ${champ.name} (Key: ${champ.key}, ID: ${champ.id})`, "color: blue;");
        loadSkins(champ.id, champ.name, parseInt(champ.key)); // Pass champion key (numeric)
      });
      championListEl.appendChild(div);
    });
  } catch (error) {
    console.error('Champion loading error:', error);
    championListEl.innerHTML = '<div class="loading">Failed to load champions. Please refresh.</div>';
  }
}

searchBox.addEventListener('input', (e) => {
  const searchTerm = e.target.value.toLowerCase();
  document.querySelectorAll('.champion-item').forEach(item => {
    const championName = item.dataset.championName;
    item.classList.toggle('hidden', !(championName && championName.includes(searchTerm)));
  });
});

async function loadSkins(championStringId, championName, championNumericKey) { 
  console.log(`%cLoading skins for ${championName} (Numeric Key: ${championNumericKey})`, "color: purple;");
  skinsList.innerHTML = '<div class="loading">Loading skins...</div>';
  skinsHeaderEl.style.display = 'block';
  skinsHeaderEl.textContent = `${championName} Skins`;

  try {
    const response = await fetch(`${DDRAGON_BASE_URL}/${patchVersion}/data/en_US/champion/${championStringId}.json`);
    if (!response.ok) throw new Error(`HTTP error loading champion details for ${championStringId}: ${response.status}`);
    
    const data = await response.json();
    skinsList.innerHTML = '';
    const ddragonSkins = data.data[championStringId].skins;

    if (!ddragonSkins || ddragonSkins.length === 0) {
      skinsList.innerHTML = '<div class="loading">No skins found for this champion.</div>';
      return;
    }

    console.log(`Found ${ddragonSkins.length} skins for ${championName} from DDragon.`);

    ddragonSkins.forEach((skin, index) => {
      const skinNum = skin.num; // DDragon's relative skin number for the champion
      const ddragonSkinId = parseInt(skin.id); // FULL skin ID, e.g., 266000, 266001. This is championKey + skinNum.
      const skinName = skin.name === 'default' ? `${championName} Classic` : skin.name;
      
      console.log(`Processing DDragon Skin: Name: "${skinName}", DDragon Full ID: ${ddragonSkinId}, Num: ${skinNum}`);

      const card = document.createElement('div');
      card.className = 'skin-card';
      card.style.animationDelay = `${index * 0.05}s`;
      
      const skinImg = document.createElement('img');
      skinImg.alt = `${skinName} splash`;
      skinImg.src = `${DDRAGON_BASE_URL}/img/champion/splash/${championStringId}_${skinNum}.jpg`;
      skinImg.onerror = function() { 
        this.src = `${CDRAGON_BASE_URL}/v1/champion-splashes/${championNumericKey}/${ddragonSkinId}.jpg`;
        this.onerror = function() { 
            this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMzMzIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNiIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlIE5vdCBGb3VuZDwvdGV4dD48L3N2Zz4=';
        }
      };

      const title = document.createElement('h3');
      title.textContent = skinName;
      const skinInfo = document.createElement('p');
      skinInfo.textContent = `Skin Num: ${skinNum}`;

      card.appendChild(skinImg);
      card.appendChild(title);
      card.appendChild(skinInfo);
      
      if (!allSkinsData) {
          console.error("CRITICAL: allSkinsData is null or undefined when trying to lookup chromas for skin: " + skinName);
      } else {
          const cdragonChromasForThisSkin = allSkinsData.get(ddragonSkinId); // Use the FULL numeric skin ID for lookup
          console.log(`Attempting to find chromas for skin ID ${ddragonSkinId} ("${skinName}"). Found in allSkinsData:`, cdragonChromasForThisSkin ? `${cdragonChromasForThisSkin.length} chromas` : 'Not Found/Undefined');

          if (cdragonChromasForThisSkin && cdragonChromasForThisSkin.length > 0) {
            console.log(`%cAttaching chroma modal listener to "${skinName}" (ID: ${ddragonSkinId}) because ${cdragonChromasForThisSkin.length} chromas were found.`, "color: green;");
            card.classList.add('has-chromas');
            card.addEventListener('click', () => {
                console.log(`%cSkin card for "${skinName}" clicked, opening chroma modal.`, "color: cyan;");
                openChromaModal(championNumericKey, skin, skinName, cdragonChromasForThisSkin);
            });
          } else {
            console.log(`%cNo chromas found or empty array for "${skinName}" (ID: ${ddragonSkinId}). NOT attaching listener.`, "color: orange;");
          }
      }
      skinsList.appendChild(card);
    });
  } catch (err) {
    console.error(`Skin loading error for ${championName}:`, err);
    skinsList.innerHTML = `<div class="loading">Failed to load skins for ${championName}. Error: ${err.message}</div>`;
  }
}

// WIKI_REDIRECT_BASE_URL ve CDRAGON_CHROMA_IMAGES_BASE_URL global scope'ta
const WIKI_REDIRECT_BASE_URL = 'https://leagueoflegends.fandom.com/wiki/Special:Redirect/file';
const CDRAGON_CHROMA_IMAGES_BASE_URL = 'https://raw.communitydragon.org/latest/plugins/rcp-be-lol-game-data/global/default/v1/champion-chroma-images';

function openChromaModal(championNumericKey, ddragonSkinData, baseSkinName, cdragonChromasArray) {
  console.log(`%c--- Opening Chroma Modal for: ${baseSkinName} ---`, "background-color: #4CAF50; color: white; padding: 2px; font-weight: bold;");
  // ... (diÄŸer loglar ve deÄŸiÅŸken tanÄ±mlamalarÄ± aynÄ± kalacak) ...

  chromaModalTitle.textContent = `${baseSkinName} - Chromas`;
  chromaListEl.innerHTML = '';

  const mainSkinDDragonSplashUrlForFallback = `${DDRAGON_BASE_URL}/img/champion/splash/${selectedChampionData.id}_${ddragonSkinData.num}.jpg`;
  chromaModalSplash.dataset.mainSplashFallback = mainSkinDDragonSplashUrlForFallback;

  const baseChromaDDragonSkinId = parseInt(ddragonSkinData.id);
  const wikiFormattedChampName = selectedChampionData.id.replace(/ /g, '_').replace(/'/g, '%27').replace(/\./g, '');

  let baseSkinWikiThumbTry1_Filename = `${wikiFormattedChampName}_OriginalSkin.png`;
  let baseSkinWikiThumbTry2_Filename = `${wikiFormattedChampName}_OriginalSkin.jpg`;

  if (!baseSkinName.toLowerCase().includes("classic")) {
      let skinNameOnly = baseSkinName.replace(selectedChampionData.name, '').trim().replace(/ /g, '_');
      if (skinNameOnly) {
        baseSkinWikiThumbTry1_Filename = `${wikiFormattedChampName}_${skinNameOnly}_(Base).png`;
        baseSkinWikiThumbTry2_Filename = `${wikiFormattedChampName}_${skinNameOnly}_(Base).jpg`;
      }
  }

  const baseChromaEntry = {
    id: baseChromaDDragonSkinId,
    name: "Base Skin", 
    isBase: true,
    primaryCdragonThumbnailUrl: `${CDRAGON_CHROMA_IMAGES_BASE_URL}/${championNumericKey}/${baseChromaDDragonSkinId}.png`,
    secondaryWikiThumbnailUrlPng: `${WIKI_REDIRECT_BASE_URL}/${baseSkinWikiThumbTry1_Filename}`,
    tertiaryWikiThumbnailUrlJpg: `${WIKI_REDIRECT_BASE_URL}/${baseSkinWikiThumbTry2_Filename}`,
    quaternaryDdragonLoadingUrl: `${DDRAGON_BASE_URL}/img/champion/loading/${selectedChampionData.id}_${ddragonSkinData.num}.jpg`,
    quinaryDdragonSquareUrl: `${DDRAGON_BASE_URL}/${patchVersion}/img/champion/${selectedChampionData.image.full}`,
    chromaNameForDisplay: "Base",
    actualDisplayUrl: '' 
  };
  console.log("OluÅŸturulan BaseChromaEntry:", JSON.parse(JSON.stringify(baseChromaEntry)));
  
  chromaModalSplash.src = baseChromaEntry.primaryCdragonThumbnailUrl; 
  baseChromaEntry.actualDisplayUrl = baseChromaEntry.primaryCdragonThumbnailUrl; 

  chromaModalSplash.onerror = function() { 
    console.warn(`Ä°lk Ana Splash (deneme: ${this.src}) yÃ¼klenemedi. Sonraki deneniyor.`);
    let nextAttemptForInitialSplash = null;
    if (this.src === baseChromaEntry.primaryCdragonThumbnailUrl) { 
        nextAttemptForInitialSplash = baseChromaEntry.secondaryWikiThumbnailUrlPng;
    } else if (this.src === baseChromaEntry.secondaryWikiThumbnailUrlPng) {
        nextAttemptForInitialSplash = baseChromaEntry.tertiaryWikiThumbnailUrlJpg;
    } else if (this.src === baseChromaEntry.tertiaryWikiThumbnailUrlJpg) { 
        nextAttemptForInitialSplash = chromaModalSplash.dataset.mainSplashFallback; 
    } else if (this.src === chromaModalSplash.dataset.mainSplashFallback) { 
        console.error(`DDragon ana splash da yÃ¼klenemedi. Placeholder gÃ¶steriliyor.`);
        nextAttemptForInitialSplash = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMjIyIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIzMCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPlNwbGFzaCBOb3QgRm91bmQ8L3RleHQ+PC9zdmc+';
        this.onerror = null; 
    }
    if(nextAttemptForInitialSplash) this.src = nextAttemptForInitialSplash;
    baseChromaEntry.actualDisplayUrl = this.src; 
  };
  console.log(`Modal iÃ§in ilk Ana Splash denemesi ayarlandÄ±: ${chromaModalSplash.src}`);


  const allDisplayableChromas = [baseChromaEntry, ...cdragonChromasArray];

  allDisplayableChromas.forEach((chromaLoopItem, loopIndex) => {
    const chromaItem = document.createElement('div');
    chromaItem.className = 'chroma-item';
    if (loopIndex === 0) chromaItem.classList.add('active');

    const chromaImg = document.createElement('img');
    let currentChromaNameForDisplay = "Bilinmeyen Chroma";
    let currentThumbnailUrlToTry = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iIzMzMyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iOCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIFRodW1iPC90ZXh0Pjwvc3ZnPg==';
    chromaLoopItem.actualDisplayUrl = ''; 

    if (chromaLoopItem.isBase) {
        currentChromaNameForDisplay = chromaLoopItem.chromaNameForDisplay; // "Temel"
        currentThumbnailUrlToTry = chromaLoopItem.primaryCdragonThumbnailUrl; 
        chromaLoopItem.actualDisplayUrl = currentThumbnailUrlToTry;
        console.log(`    Base Skin - Ä°sim: "${currentChromaNameForDisplay}"`);
        console.log(`    Base Skin - Attempting CDragon Thumbnail for small icon: "${currentThumbnailUrlToTry}"`);
    } else { 
        const rawCdragonChroma = chromaLoopItem;
        const chromaArrayIndex = loopIndex - 1; 

        console.log(`%cProcessing CDragon Chroma (array index ${chromaArrayIndex} / display index ${loopIndex}):`, "color: green; font-weight:bold;");
        console.log("  Raw CDragon Chroma Object:", JSON.parse(JSON.stringify(rawCdragonChroma)));
        
        let displayChromaNamePart = "";
        let displayChromaIdSuffix = "";
        let simpleChromaId = "";

        let chromaIdString = String(rawCdragonChroma.id); // Ã¶rn: "266004"
        let championKeyString = String(championNumericKey); // Ã¶rn: "266"

        if (chromaIdString.startsWith(championKeyString) && chromaIdString.length > championKeyString.length) {
            simpleChromaId = chromaIdString.substring(championKeyString.length); // Ã¶rn: "004"
            simpleChromaId = parseInt(simpleChromaId, 10); // Ã¶rn: 4
            displayChromaIdSuffix = `(ID: ${simpleChromaId})`;
        } else {
            simpleChromaId = rawCdragonChroma.id; // EÄŸer ÅŸampiyon key ile baÅŸlamÄ±yorsa, tam ID'yi al
            displayChromaIdSuffix = `(ID: ${simpleChromaId})`;
        }


        if ((rawCdragonChroma.name && rawCdragonChroma.name.toLowerCase().includes("elite")) ||
            (rawCdragonChroma.skinClassification === 'kRecolor' && cdragonChromasArray.length === 1)) {
            displayChromaNamePart = "Elite";
        } else {
            // Ä°simlendirme: Ana KostÃ¼m AdÄ± - Chroma X (ID: Y)
             displayChromaNamePart = `Chroma ${chromaArrayIndex + 1}`;
        }
        currentChromaNameForDisplay = `${baseSkinName} - ${displayChromaNamePart} ${displayChromaIdSuffix}`;
        console.log(`    CDragon Chroma - Belirlenen Ä°sim: "${currentChromaNameForDisplay}"`);

        // --- THUMBNAIL URL (Ã–NCELÄ°KLE YENÄ° CDRAGON YOLU) ---
        if (rawCdragonChroma.id) { 
            currentThumbnailUrlToTry = `${CDRAGON_CHROMA_IMAGES_BASE_URL}/${championNumericKey}/${rawCdragonChroma.id}.png`;
            chromaLoopItem.actualDisplayUrl = currentThumbnailUrlToTry; 
            console.log(`    DENENEN CDRAGON Thumbnail URL (yeni path): "${currentThumbnailUrlToTry}"`);
        } else {
            console.warn(`    CDragon Thumbnail oluÅŸturulamadÄ± (chroma.id eksik):`, rawCdragonChroma);
            const placeholderSvg = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iIzMzMyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iOCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIFRodW1iPC90ZXh0Pjwvc3ZnPg==';
            currentThumbnailUrlToTry = placeholderSvg;
            chromaLoopItem.actualDisplayUrl = placeholderSvg;
        }

        if (displayChromaNamePart.toLowerCase() === "elite") {
            const eliteWikiFilename = `${wikiFormattedChampName}_${baseSkinName.replace(selectedChampionData.name, '').trim().replace(/ /g, '_')}_(Elite).png`;
            chromaLoopItem.wikiFallbackThumbnailUrl = `${WIKI_REDIRECT_BASE_URL}/${eliteWikiFilename}`; 
            if (!rawCdragonChroma.id || currentThumbnailUrlToTry.includes('data:image/svg+xml')) { 
                 console.log(`    "Elite" iÃ§in CDragon path/ID yok veya hatalÄ±. Wiki deneniyor: ${chromaLoopItem.wikiFallbackThumbnailUrl}`);
                 currentThumbnailUrlToTry = chromaLoopItem.wikiFallbackThumbnailUrl;
                 chromaLoopItem.actualDisplayUrl = chromaLoopItem.wikiFallbackThumbnailUrl;
            }
        }
    }

    chromaImg.src = currentThumbnailUrlToTry;
    chromaImg.alt = currentChromaNameForDisplay;

    chromaImg.onload = function() {
        // ... (aynÄ±)
        chromaLoopItem.actualDisplayUrl = this.src;
        console.log(`Thumbnail yÃ¼klendi: ${this.src}. BÃ¼yÃ¼k gÃ¶sterim iÃ§in saklanan URL: ${chromaLoopItem.actualDisplayUrl}`);
        if (loopIndex === 0 && chromaModalSplash.src !== this.src ) { 
             if (this.src && !this.src.includes('data:image/svg+xml') && this.src !== chromaModalSplash.dataset.mainSplashFallback) { 
                chromaModalSplash.src = this.src;
                console.log(`BaÅŸlangÄ±Ã§ Ana Splash, base skin thumbnail onload ile gÃ¼ncellendi: ${this.src}`);
             }
        }
    };

    chromaImg.onerror = function() {
        // ... (aynÄ±)
        console.warn(`KÃ¼Ã§Ã¼k resim yÃ¼klenemedi (onerror) - Denenen URL: ${this.src}`);
        let nextAttemptUrl = null;
        const placeholderSvg = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iIzMzMyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iOCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIFRodW1iPC90ZXh0Pjwvc3ZnPg==';
        chromaLoopItem.actualDisplayUrl = placeholderSvg;

        if (chromaLoopItem.isBase) {
            if (this.src === chromaLoopItem.primaryCdragonThumbnailUrl) {
                nextAttemptUrl = chromaLoopItem.secondaryWikiThumbnailUrlPng;
            } else if (this.src === chromaLoopItem.secondaryWikiThumbnailUrlPng) { 
                nextAttemptUrl = chromaLoopItem.tertiaryWikiThumbnailUrlJpg;
            } else if (this.src === chromaLoopItem.tertiaryWikiThumbnailUrlJpg) { 
                nextAttemptUrl = chromaLoopItem.quaternaryDdragonLoadingUrl;
            } else if (this.src === chromaLoopItem.quaternaryDdragonLoadingUrl) {
                nextAttemptUrl = chromaLoopItem.quinaryDdragonSquareUrl;
            }
        } else { 
            if (this.src.startsWith(CDRAGON_CHROMA_IMAGES_BASE_URL) && chromaLoopItem.wikiFallbackThumbnailUrl) {
                 console.log(`    CDragon chroma thumbnail baÅŸarÄ±sÄ±z. "Elite" iÃ§in Wiki deneniyor: ${chromaLoopItem.wikiFallbackThumbnailUrl}`);
                 nextAttemptUrl = chromaLoopItem.wikiFallbackThumbnailUrl;
            } 
            else if (this.src.startsWith(WIKI_REDIRECT_BASE_URL) && this.src.endsWith(".png") && chromaLoopItem.wikiFallbackThumbnailUrl && this.src === chromaLoopItem.wikiFallbackThumbnailUrl) { 
                 const wikiJpgAttemptUrl = this.src.replace(".png", ".jpg");
                 console.log(`    CDragon Chroma - Wiki .png attempt failed for Elite. Trying Wiki .jpg: ${wikiJpgAttemptUrl}`);
                 nextAttemptUrl = wikiJpgAttemptUrl;
            }
        }

        if (nextAttemptUrl) {
            console.log(`    Fallback deneniyor: ${nextAttemptUrl}`);
            this.src = nextAttemptUrl;
        } else { 
            console.error(`Resim yÃ¼klenemedi (onerror) - BaÅŸka fallback yok (${chromaLoopItem.name}). Son deneme: ${this.src}. Placeholder gÃ¶steriliyor.`);
            this.src = placeholderSvg;
            chromaLoopItem.actualDisplayUrl = placeholderSvg;
            this.onerror = null; 
        }
    };
    
    const nameSpan = document.createElement('span');
    nameSpan.className = 'chroma-item-name';
    nameSpan.textContent = currentChromaNameForDisplay;

    chromaItem.appendChild(chromaImg);
    chromaItem.appendChild(nameSpan);

    chromaItem.addEventListener('click', () => {
      // ... (tÄ±klama mantÄ±ÄŸÄ± aynÄ±)
      console.log(`Chroma thumbnail seÃ§ildi: ${currentChromaNameForDisplay}`);
      const displayUrlForSplash = chromaLoopItem.actualDisplayUrl || chromaImg.src; 
      
      console.log(`BÃ¼yÃ¼k resim iÃ§in kullanÄ±lacak URL: ${displayUrlForSplash}`);
      if (displayUrlForSplash && !displayUrlForSplash.includes('data:image/svg+xml')) {
        chromaModalSplash.src = displayUrlForSplash; 
        chromaModalSplash.onerror = function() {
            console.warn(`BÃ¼yÃ¼k resim (Splash AlanÄ±) yÃ¼klenemedi (onerror): ${this.src}`);
            const mainSplashFallback = chromaModalSplash.dataset.mainSplashFallback;
            if (mainSplashFallback) {
                this.src = mainSplashFallback; 
                this.onerror = function() { 
                    console.error(`BÃ¼yÃ¼k resim iÃ§in ana kostÃ¼m splash'Ä± da BAÅžARISIZ: ${this.src}`);
                    this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMjIyIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIzMCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPlNwbGFzaCBOb3QgRm91bmQ8L3RleHQ+PC9zdmc+';
                    this.onerror = null;
                }
            } else { 
                this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMjIyIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIzMCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPlNwbGFzaCBOb3QgRm91bmQ8L3RleHQ+PC9zdmc+';
                this.onerror = null;
            }
        };
      } else {
          console.warn("BÃ¼yÃ¼k resim iÃ§in geÃ§erli bir URL bulunamadÄ±, ana kostÃ¼m DDragon splash'Ä±na fallback yapÄ±lÄ±yor.");
          chromaModalSplash.src = chromaModalSplash.dataset.mainSplashFallback || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMjIyIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIzMCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPlNwbGFzaCBOb3QgRm91bmQ8L3RleHQ+PC9zdmc+';
      }
      
      document.querySelectorAll('.chroma-item.active').forEach(i => i.classList.remove('active'));
      chromaItem.classList.add('active');
    });
    chromaListEl.appendChild(chromaItem);

  }); // End of forEach

  chromaModal.classList.add('visible');
}

// Kapatma Butonu ve ESC tuÅŸu event listener'larÄ± script'in sonunda olmalÄ±
// ... (scriptinizin geri kalanÄ±nÄ± buraya ekleyin, en sonda da initializeApp() Ã§aÄŸrÄ±sÄ±)
chromaModalClose.addEventListener('click', () => {
  console.log("Chroma modal close button clicked.");
  chromaModal.classList.remove('visible');
});

window.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && chromaModal.classList.contains('visible')) {
    console.log("Escape key pressed, closing chroma modal.");
    chromaModal.classList.remove('visible');
  }
});
chromaModal.addEventListener('click', (e) => {
    if (e.target === chromaModal) { 
        console.log("Clicked outside chroma modal content, closing.");
        chromaModal.classList.remove('visible');
    }
});

// DEBUG BUTTON - Event listener
const debugButton = document.getElementById('debugOpenModalButton');
debugButton.addEventListener('click', () => {
    console.log("DEBUG BUTTON CLICKED: Forcing chroma modal open with placeholder data.");
    if (!selectedChampionData) {
        selectedChampionData = { id: 'Aatrox', name: 'Aatrox', key: '266', image: { full: 'Aatrox.png'} }; 
    }
    const dummyDDragonSkin = { id: `${selectedChampionData.key}000`, num: 0, name: 'Placeholder Classic Skin' };
    const dummyCDragonChromas = [
        { id: parseInt(`${selectedChampionData.key}000001`), name: "Placeholder Chroma 1", chromaPath: "/nonexistent/path1.png", colors: ["Red"] }, // ID'yi sayÄ± yapalÄ±m
        { id: parseInt(`${selectedChampionData.key}000002`), name: "Placeholder Chroma 2", chromaPath: "/nonexistent/path2.png", colors: ["Blue"] } // ID'yi sayÄ± yapalÄ±m
    ];
    openChromaModal(parseInt(selectedChampionData.key), dummyDDragonSkin, "Placeholder Skin Name", dummyCDragonChromas);
});

initializeApp();
</script>

</body>
</html>